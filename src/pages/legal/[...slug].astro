---
import Layout from "@components/Layout.astro"
import { getCollection } from 'astro:content';

import TableOfContents from '../../components/TableOfContents.astro';
import { extractHeadings, filterHeadingsForTOC } from '../../utils/table-of-contents';
import { calculateReadingTime, extractTextFromMarkdown } from '../../utils/reading-time';

const legalEntries = await getCollection('legal');

// Sort entries by title
const sortedEntries = legalEntries.sort((a, b) => a.data.title.localeCompare(b.data.title));


export async function getStaticPaths() {
  // Support both .md and .mdx files
  const mdPostsGlob = import.meta.glob('../../content/blog/*.md', { eager: true });
  const mdxPostsGlob = import.meta.glob('../../content/blog/*.mdx', { eager: true });
  
  const allPosts = [...Object.values(mdPostsGlob), ...Object.values(mdxPostsGlob)] as any[];
  
  return allPosts.map((post: any) => {
    // For import.meta.glob, access raw content through compiledContent or body
    const rawContent = post.body || post.rawContent?.() || '';
    const plainText = extractTextFromMarkdown(rawContent);
    const readingTime = calculateReadingTime(plainText);
    const allHeadings = extractHeadings(rawContent);
    const tocHeadings = filterHeadingsForTOC(allHeadings);
    
    return {
      params: { slug: post.file.split('/').pop()?.replace(/\.(md|mdx)$/, '') },
      props: { post, readingTime, tocHeadings }
    };
  });
}

const { post, readingTime, tocHeadings } = Astro.props;
const { frontmatter, Content } = post as any;

const pageTitle = frontmatter.title;
const publishedTime = frontmatter.date ? new Date(frontmatter.date).toISOString() : undefined;
---

<Layout 
  title={pageTitle} 
  description={frontmatter.description || frontmatter.excerpt}
  type="article"
  publishedTime={publishedTime}
  showSidebar={false}
>

</Layout>